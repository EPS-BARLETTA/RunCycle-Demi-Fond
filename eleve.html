<!DOCTYPE html><html lang="fr"><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>RunCycle ‚Äî √âl√®ve</title>
<style>
:root{--bg:#0f172a;--ink:#e5e7eb;--muted:#94a3b8;--line:#243042;--panel:#0b1220}
*{box-sizing:border-box}
body{font-family:system-ui,-apple-system,Segoe UI,Inter,Roboto,Arial,sans-serif;background:var(--bg);color:var(--ink);margin:0}
header,footer{border-block:1px solid var(--line);padding:18px;text-align:center}
main{max-width:980px;margin:0 auto;padding:18px}
.card{background:rgba(255,255,255,.04);border:1px solid var(--line);border-radius:14px;padding:14px;margin:10px 0}
.grid{display:grid;gap:10px;grid-template-columns:repeat(auto-fit,minmax(260px,1fr))}
.btn{display:inline-block;padding:12px 16px;border-radius:12px;border:1px solid var(--line);background:var(--panel);color:var(--ink);margin-right:8px;cursor:pointer}
input,select,textarea{width:100%;padding:10px;border-radius:10px;border:1px solid var(--line);background:var(--panel);color:var(--ink)}
.pill{display:inline-block;border:1px solid var(--line);border-radius:999px;padding:4px 8px;color:var(--muted);font-size:14px}
table{width:100%;border-collapse:collapse}th,td{border:1px solid var(--line);padding:6px;text-align:left}
.timer{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.time{font:700 28px/1 ui-monospace,Menlo,Consolas,monospace;padding:8px 12px;border:1px solid var(--line);border-radius:10px;background:#111827}
</style>
<body>
<header><h1>RunCycle ‚Äî √âl√®ves</h1><div style="color:#94a3b8">Code ‚Üí VMA + piste ‚Üí Cibles ‚Üí Chrono ‚Üí Distances + RPE ‚Üí QR</div></header>
<main>
  <div class="card">
    <b>üîì Charger la s√©ance</b>
    <div class="grid">
      <div><label>Code s√©ance</label><input id="code" placeholder="ex: 202B"></div>
      <div><label>Piste (m)</label><input id="piste" type="number" min="50" value="200"></div>
    </div>
    <div style="margin-top:8px"><button class="btn" onclick="load()">‚úÖ Utiliser le code</button></div>
    <div id="desc" class="pill" style="display:none;margin-top:8px"></div>
  </div>

  <div class="grid" id="profiles" style="display:none">
    <div class="card"><b>üë§ √âl√®ve A</b><div class="grid">
      <div><label>Nom</label><input id="aNom"></div><div><label>Pr√©nom</label><input id="aPre"></div>
      <div><label>Classe</label><input id="aCla"></div><div><label>Sexe</label><select id="aSex"><option>F</option><option>M</option></select></div>
      <div><label>VMA (km/h)</label><input id="aVMA" type="number" step="0.1" oninput="targets()"></div>
    </div></div>
    <div class="card"><b>üë§ √âl√®ve B</b><div class="grid">
      <div><label>Nom</label><input id="bNom"></div><div><label>Pr√©nom</label><input id="bPre"></div>
      <div><label>Classe</label><input id="bCla"></div><div><label>Sexe</label><select id="bSex"><option>F</option><option selected>M</option></select></div>
      <div><label>VMA (km/h)</label><input id="bVMA" type="number" step="0.1" oninput="targets()"></div>
    </div></div>
  </div>

  <div id="work" class="card" style="display:none">
    <b>üéØ Cibles & Chrono</b>
    <div id="tg" class="pill" style="display:block;margin:8px 0">Renseignez la VMA‚Ä¶</div>
    <div class="timer">
      <span class="pill" id="phase">Pr√™t</span>
      <span class="time" id="clock">00:00</span>
      <button class="btn" onclick="start()">‚ñ∂Ô∏è Start</button>
      <button class="btn" onclick="pause()">‚è∏Ô∏è Pause</button>
      <button class="btn" onclick="reset()">‚Ü∫ Reset</button>
      <span class="pill">Bloc <span id="i">0</span>/<span id="n">0</span></span>
    </div>
  </div>

  <div id="saisie" class="card" style="display:none">
    <b>üìù Saisie des blocs & RPE</b>
    <table><thead><tr><th>Bloc</th><th>Distance A (m)</th><th>RPE A</th><th>Distance B (m)</th><th>RPE B</th></tr></thead><tbody id="tb"></tbody></table>
    <div style="margin-top:8px">
      <button class="btn" onclick="qr('duo')">üî≥ QR DUO</button>
      <button class="btn" onclick="qr('A')">QR A</button>
      <button class="btn" onclick="qr('B')">QR B</button>
    </div>
    <div id="q" style="margin-top:8px"></div>
  </div>
</main>
<footer>RunCycle ‚Äî √âquipe EPS Lyc√©e Vauban ‚Äî Luxembourg ‚Äî JB</footer>

<script>
const PRESETS={"101A":{T:"Test 6' (VMA)",B:1,Db:6,R:0,P:[]},
"202B":{T:"2√ó6' @90% (r=3')",B:2,Db:6,R:3,P:[0.9,0.9]},
"303C":{T:"3√ó4' 80/90/100% (r=2')",B:3,Db:4,R:2,P:[0.8,0.9,1.0]},
"404D":{T:"4√ó3' 90‚Üí95% (r=2')",B:4,Db:3,R:2,P:[0.9,0.92,0.94,0.95]},
"505E":{T:"√âval 4√ó3' @95% (r=2')",B:4,Db:3,R:2,P:[0.95,0.95,0.95,0.95]}};
let S=null, timer=null, rem=0, ph='Pr√™t', b=0;
function load(){
  const c=(document.getElementById('code').value||'').trim().toUpperCase(); if(!PRESETS[c]){alert('Code inconnu : 101A..505E'); return;}
  const piste=+document.getElementById('piste').value||200;
  const p=PRESETS[c]; S={T:p.T,B:p.B,Db:p.Db,R:p.R,P:p.P,Piste:piste};
  document.getElementById('desc').textContent=p.T+' ‚Ä¢ blocs: '+p.B+' ‚Ä¢ '+p.Db+"' r="+p.R+"' ‚Ä¢ piste "+piste+' m'; document.getElementById('desc').style.display='inline-block';
  document.getElementById('profiles').style.display='grid'; document.getElementById('work').style.display='block'; document.getElementById('saisie').style.display='block';
  document.getElementById('n').textContent=S.B; build(); targets();
}
function build(){
  const tb=document.getElementById('tb'); tb.innerHTML=''; for(let i=1;i<=S.B;i++){tb.insertAdjacentHTML('beforeend','<tr><td>'+i+'</td><td><input id=a_m_'+i+' type=number min=0></td><td><input id=a_r_'+i+' type=number min=0 max=10></td><td><input id=b_m_'+i+' type=number min=0></td><td><input id=b_r_'+i+' type=number min=0 max=10></td></tr>');}
}
function mpm(k){return k*1000/60}
function targets(){
  const a=+document.getElementById('aVMA').value||0, b=+document.getElementById('bVMA').value||0, pct=S.P.length?S.P:Array(S.B).fill(1);
  const dA=a?pct.map(p=>Math.round(mpm(a*p)*S.Db)):[], dB=b?pct.map(p=>Math.round(mpm(b*p)*S.Db)):[];
  document.getElementById('tg').innerHTML=(a||b)?('Cibles ‚Äî A: <b>'+ (dA.join(' ‚Ä¢ ')||'‚Äî') + '</b> | B: <b>' + (dB.join(' ‚Ä¢ ')||'‚Äî') + '</b>'):'Renseignez la VMA‚Ä¶';
}
function start(){ if(timer) clearInterval(timer); tick(); timer=setInterval(tick,1000); }
function pause(){ if(timer) clearInterval(timer); }
function reset(){ if(timer) clearInterval(timer); ph='Pr√™t'; b=0; rem=0; document.getElementById('phase').textContent='Pr√™t'; document.getElementById('clock').textContent='00:00'; document.getElementById('i').textContent='0'; }
function fmt(s){const m=Math.floor(s/60),x=s%60; return String(m).padStart(2,'0')+':'+String(x).padStart(2,'0'); }
function tick(){
  const t=document.getElementById('clock'), phs=document.getElementById('phase'), idx=document.getElementById('i');
  if(rem>0){rem--; t.textContent=fmt(rem);} else {
    if(ph==='Pr√™t' || ph==='R√©cup'){ if(b>=S.B){ clearInterval(timer); phs.textContent='Termin√©'; return; } b++; idx.textContent=b; ph='Effort'; phs.textContent='Effort'; rem=S.Db*60; t.textContent=fmt(rem); }
    else{ if(S.R>0){ ph='R√©cup'; phs.textContent='R√©cup'; rem=S.R*60; t.textContent=fmt(rem); } else { if(b>=S.B){ clearInterval(timer); phs.textContent='Termin√©'; return; } b++; idx.textContent=b; ph='Effort'; phs.textContent='Effort'; rem=S.Db*60; t.textContent=fmt(rem); } }
  }
}
function kmh(m, min){ return (m/1000)/(min/60) }
function mean(a){ return a.reduce((x,y)=>x+y,0)/a.length }
function qr(mode){
  const n=S.B, a={Nom:(document.getElementById('aNom').value||'').toUpperCase(),Pr√©nom:document.getElementById('aPre').value||'',Classe:document.getElementById('aCla').value||'',Sexe:document.getElementById('aSex').value||'',VMA:+document.getElementById('aVMA').value||0},
        b={Nom:(document.getElementById('bNom').value||'').toUpperCase(),Pr√©nom:document.getElementById('bPre').value||'',Classe:document.getElementById('bCla').value||'',Sexe:document.getElementById('bSex').value||'',VMA:+document.getElementById('bVMA').value||0};
  const am=[],ar=[],bm=[],br=[]; for(let i=1;i<=n;i++){am.push(+document.getElementById('a_m_'+i).value||0);ar.push(+document.getElementById('a_r_'+i).value||0);bm.push(+document.getElementById('b_m_'+i).value||0);br.push(+document.getElementById('b_r_'+i).value||0);}
  const totMin=S.B*S.Db, vA=kmh(am.reduce((x,y)=>x+y,0),totMin), vB=kmh(bm.reduce((x,y)=>x+y,0),totMin), pct=S.P.length?S.P:Array(S.B).fill(1),
        cibleA=a.VMA?(a.VMA*mean(pct)):0, cibleB=b.VMA?(b.VMA*mean(pct)):0, ecA=+(vA-cibleA).toFixed(2), ecB=+(vB-cibleB).toFixed(2);
  let payload=null;
  if(mode==='duo'){ payload={v:1,format:'duo',Seance:S.T,Piste_m:S.Piste,eleves:[{Nom:a.Nom,Pr√©nom:a.Pr√©nom,Classe:a.Classe,Sexe:a.Sexe,VMA:a.VMA,Blocs_m:am,RPE:ar,Vitesse_moy_km_h:+vA.toFixed(2),Ecart_km_h:ecA},{Nom:b.Nom,Pr√©nom:b.Pr√©nom,Classe:b.Classe,Sexe:b.Sexe,VMA:b.VMA,Blocs_m:bm,RPE:br,Vitesse_moy_km_h:+vB.toFixed(2),Ecart_km_h:ecB}]}; }
  else if(mode==='A'){ payload={v:1,format:'solo',Seance:S.T,Piste_m:S.Piste,Nom:a.Nom,Pr√©nom:a.Pr√©nom,Classe:a.Classe,Sexe:a.Sexe,VMA:a.VMA,Blocs_m:am,RPE:ar,Vitesse_moy_km_h:+vA.toFixed(2),Ecart_km_h:ecA}; }
  else { payload={v:1,format:'solo',Seance:S.T,Piste_m:S.Piste,Nom:b.Nom,Pr√©nom:b.Pr√©nom,Classe:b.Classe,Sexe:b.Sexe,VMA:b.VMA,Blocs_m:bm,RPE:br,Vitesse_moy_km_h:+vB.toFixed(2),Ecart_km_h:ecB}; }
  const json=JSON.stringify(payload), url='https://api.qrserver.com/v1/create-qr-code/?size=220x220&data='+encodeURIComponent(json);
  document.getElementById('q').innerHTML='<div><img alt="QR" src="'+url+'"><textarea rows="5" style="width:100%;margin-top:8px">'+json+'</textarea></div>';
}
</script>
</body></html>
