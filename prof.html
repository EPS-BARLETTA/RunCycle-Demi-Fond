
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RunCycle ‚Äî Mode Prof</title>
  <link rel="stylesheet" href="./style.css" />
  <script src="./core.js" defer></script>
</head>
<body>
  <div id="gate" class="gate">
    <div class="gate-card">
      <h2>üîí Acc√®s Prof</h2>
      <p class="sub">Entrez le code pour ouvrir le mode Prof.</p>
      <div class="row"><input id="gateCode" type="password" inputmode="numeric" placeholder="Code" style="flex:1"><button class="btn primary" id="gateBtn">Ouvrir</button></div>
      <div id="gateErr" class="sub" style="color:#ef4444;margin-top:8px;display:none">Code incorrect</div>
      <div class="row" style="margin-top:10px"><a class="btn" href="./index.html">‚¨ÖÔ∏è Accueil</a></div>
    </div>
  </div>

  <header>
    <h1>RunCycle ‚Äî Mode Prof</h1>
    <div class="sub">S√©ances type ou personnalis√©es ‚Ä¢ Donnez un <b>code oral</b> aux √©l√®ves</div>
  </header>

  <main>
    <section class="card" id="profMain">
      <h2>üóìÔ∏è Cr√©er / choisir la s√©ance</h2>
      <div class="grid cols-2">
        <div>
          <label>S√©ance type</label>
          <select id="preset">
            <option value="S1">S1 ‚Äî Test 6‚Äô (VMA)</option>
            <option value="S2">S2 ‚Äî 2√ó6‚Äô @ 90% VMA ‚Ä¢ r=3‚Äô</option>
            <option value="S3">S3 ‚Äî 3√ó4‚Äô (80/90/100%) ‚Ä¢ r=2‚Äô</option>
            <option value="S4">S4 ‚Äî 4√ó3‚Äô projet (90‚Üí95%) ‚Ä¢ r=2‚Äô</option>
            <option value="S5">S5 ‚Äî √âvaluation 4√ó3‚Äô @ 95% ‚Ä¢ r=2‚Äô</option>
          </select>
        </div>
        <div>
          <label>Date</label>
          <input id="sDate" type="date">
        </div>
        <div>
          <label>Titre</label>
          <input id="sTitre" placeholder="4√ó3‚Äô r=2‚Äô @ 95% VMA">
        </div>
        <div>
          <label>Longueur de piste (m) ‚Äî saisir n'importe quelle valeur</label>
          <input id="sPiste" type="number" min="50" step="1" value="200" placeholder="ex: 180, 240, 325">
        </div>
        <div>
          <label>Nombre de blocs</label>
          <input id="sBlocs" type="number" min="1" value="4">
        </div>
        <div>
          <label>Dur√©e d‚Äôun bloc (min)</label>
          <input id="sDuree" type="number" min="1" value="3">
        </div>
        <div>
          <label>R√©cup√©ration (min)</label>
          <input id="sRecup" type="number" min="0" value="2">
        </div>
        <div>
          <label>% VMA (scalaire ou liste)</label>
          <input id="sPct" placeholder="0.95 ou 0.9,0.92,0.94,0.95" value="0.95">
        </div>
        <div style="grid-column:1/-1">
          <label>Consignes</label>
          <textarea id="sNotes" rows="3" placeholder="R√©gularit√©, d√©part prudent, finish propre"></textarea>
        </div>
      </div>
      <div class="row" style="margin-top:12px">
        <button class="btn" id="btnPreset">‚Ü∫ Charger s√©ance type</button>
        <button class="btn primary" id="btnGen">üîê G√©n√©rer / actualiser le code</button>
      </div>
      <div class="row" style="margin-top:12px">
        <div class="code-banner" id="codeBanner">CODE¬†√âL√àVES¬†: <span id="unlockCode">‚Äî</span></div>
        <span class="pill">SeanceID : <span id="sid">‚Äî</span></span>
      </div>
      <div class="grid cols-2" style="margin-top:12px">
        <div>
          <label>Remplacer le code √©l√®ves (optionnel)</label>
          <input id="manualCode" placeholder="ex: 202B ou AB12CD34">
          <div class="sub">Si rempli, c‚Äôest ce code qui sera affich√© et stock√© pour cette s√©ance.</div>
        </div>
      </div>
      <p class="sub" style="margin-top:6px">üëâ √âtapes : 1) Choisir la s√©ance type  2) ‚Äú‚Ü∫ Charger s√©ance type‚Äù  3) ‚Äúüîê G√©n√©rer / actualiser le code‚Äù  4) Dicter le code aux √©l√®ves.</p>
      <div class="center" style="margin-top:16px"><a class="btn" href="./index.html">‚¨ÖÔ∏è Retour</a></div>
    </section>
  </main>

  <footer>RunCycle ‚Äî √âquipe EPS Lyc√©e Vauban ‚Äî Luxembourg ‚Äî JB</footer>

  <script>
  // Gate (57), URL unlock supported (?p=57 or #57)
  (function(){
    function qp(n){var m=location.search.match(new RegExp('[?&]'+n+'=([^&]+)'));return m?decodeURIComponent(m[1]):null;}
    function hide(){var g=document.getElementById('gate'); if(g) g.style.display='none';}
    function tryAuto(){var h=(location.hash||'').replace('#','').trim(); var p=(qp('p')||qp('code')||'').trim(); if(h==='57'||p==='57') hide();}
    function bind(){var g=document.getElementById('gate'),b=document.getElementById('gateBtn'),i=document.getElementById('gateCode'),e=document.getElementById('gateErr');function u(){var v=(i.value||'').trim(); if(v==='57'){hide();}else{if(e) e.style.display='block';}} if(b) b.addEventListener('click',u); if(i) i.addEventListener('keydown',function(ev){if(ev.key==='Enter')u();});}
    tryAuto(); if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',bind);}else{bind();}
  })();
  </script>

  <script>
  (function(){
    function ready(fn){ if(document.readyState!=='loading') fn(); else document.addEventListener('DOMContentLoaded', fn); }
    ready(function(){
      const C = window.RunCycleCore;
      const presetSel = document.getElementById('preset');
      const dateIn = document.getElementById('sDate');
      const titreIn = document.getElementById('sTitre');
      const pisteIn = document.getElementById('sPiste');
      const blocsIn = document.getElementById('sBlocs');
      const dureeIn = document.getElementById('sDuree');
      const recupIn = document.getElementById('sRecup');
      const pctIn = document.getElementById('sPct');
      const notesIn = document.getElementById('sNotes');
      const codeSpan = document.getElementById('unlockCode');
      const sidSpan = document.getElementById('sid');
      const manualCodeIn = document.getElementById('manualCode');

      function applyPreset(){
        const p = C.PRESETS[presetSel.value];
        dateIn.value = dateIn.value || new Date().toISOString().slice(0,10);
        titreIn.value = p.Titre;
        blocsIn.value = p.Blocs;
        dureeIn.value = p.DureeBloc_min;
        recupIn.value = p.Recup_min;
        pctIn.value = p.Cible_%VMA.join(',');
        notesIn.value = p.Notes;
        pisteIn.value = pisteIn.value || 200;
      }
      function isExactlyPreset(){
        const p = C.PRESETS[presetSel.value];
        return (titreIn.value===p.Titre && Number(blocsIn.value)===p.Blocs && Number(dureeIn.value)===p.DureeBloc_min && Number(recupIn.value)===p.Recup_min && pctIn.value.replace(/\s+/g,'')===p.Cible_%VMA.join(','));
      }
      function genCode(){
        const seance = C.buildSession({ Titre:titreIn.value, DateStr:dateIn.value, Blocs:blocsIn.value, DureeBloc_min:dureeIn.value, Recup_min:recupIn.value, CiblePct:pctIn.value, Piste_m:pisteIn.value, Notes:notesIn.value });
        let codeOverride = (manualCodeIn.value||'').trim().toUpperCase();
        let code;
        if(codeOverride){
          code = codeOverride;
          if(!C.presetForCode || !C.presetForCode(code)) C.saveCustomSession(code, seance);
        }else if(isExactlyPreset()){
          code = C.codeForPreset ? C.codeForPreset(presetSel.value) : '000X';
        }else{
          code = Math.random().toString(36).slice(2,10).toUpperCase();
          C.saveCustomSession(code, seance);
        }
        codeSpan.textContent = code;
        sidSpan.textContent = seance.SeanceID;
        var banner=document.getElementById('codeBanner'); if(banner){ banner.innerHTML='CODE&nbsp;√âL√àVES&nbsp;: <span id="unlockCode">'+code+'</span>'; }
        localStorage.setItem('RC_last_seance', JSON.stringify({unlock:code, seance:seance}));
      }

      document.getElementById('btnPreset').addEventListener('click', function(){ applyPreset(); genCode(); });
      document.getElementById('btnGen').addEventListener('click', genCode);
      presetSel.addEventListener('change', function(){ applyPreset(); genCode(); });

      applyPreset(); genCode();
    });
  })();
  </script>
</body>
</html>
